# 继电器控制程序

## 功能描述

这是一个用于控制继电器的Python程序，实现以下功能：

1. 打开继电器串口1，波特率为9600
2. 发送打开命令 
3. 延时30秒之后使用ping命令测试网络连通性
4. 如果能ping通，发送关闭命令 ，再延时3秒后回到第2步继续执行
5. 如果ping不通，退出程序循环

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 基本使用

```bash
python relay_controller.py
```

### 自定义参数

```bash
python relay_controller.py --port COM1 --baudrate 9600 --ping-target 192.168.1.1
```

### 参数说明

- `--port`: 串口号（默认：COM1）
- `--baudrate`: 波特率（默认：9600）
- `--ping-target`: ping测试目标IP地址（默认：8.8.8.8）

## 程序流程

1. **串口连接**: 连接指定的串口，设置波特率等参数
2. **发送打开命令**: 向继电器发送  命令打开继电器
3. **等待30秒**: 倒计时30秒，每5秒或最后5秒会显示倒计时
4. **Ping测试**: 测试网络连通性
5. **结果处理**:
   - Ping通：发送关闭命令 ，等待3秒后继续循环
   - Ping不通：退出程序

## 日志记录

程序会同时将日志输出到：
- 控制台
- `relay_controller.log` 文件

## 注意事项

1. 确保指定的串口存在且可访问
2. 根据实际情况修改ping目标IP地址
3. 程序支持Ctrl+C中断退出
4. 如果继电器响应不同，可能需要调整命令格式或响应处理逻辑

## 故障排除

1. **串口连接失败**: 检查串口号是否正确，设备是否连接
2. **权限问题**: 确保程序有访问串口的权限
3. **Ping目标不可达**: 检查网络连接或更换ping目标地址

## 示例输出

```
2024-01-01 12:00:00,000 - INFO - 成功连接串口 COM1，波特率 9600
2024-01-01 12:00:01,000 - INFO - === 开始第 1 次循环 ===
2024-01-01 12:00:01,001 - INFO - 发送打开继电器命令...
2024-01-01 12:00:01,002 - INFO - 发送命令: a0 01 01 a2
2024-01-01 12:00:01,003 - INFO - 等待30秒后进行ping测试...
2024-01-01 12:00:01,004 - INFO - 倒计时: 30秒
...
2024-01-01 12:00:31,000 - INFO - Ping测试成功: 8.8.8.8 可达
2024-01-01 12:00:31,001 - INFO - 发送关闭继电器命令...
2024-01-01 12:00:31,002 - INFO - 发送命令: a1 01 02 a3
2024-01-01 12:00:31,003 - INFO - 等待3秒后继续下一次循环...
```